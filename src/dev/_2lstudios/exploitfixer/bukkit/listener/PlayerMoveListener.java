package dev._2lstudios.exploitfixer.bukkit.listener;

import org.bukkit.Chunk;
import org.bukkit.Location;
import org.bukkit.World;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerMoveEvent;

import dev._2lstudios.exploitfixer.bukkit.managers.ModuleManager;
import dev._2lstudios.exploitfixer.bukkit.modules.EventsModule;
import dev._2lstudios.exploitfixer.shared.modules.NotificationsModule;

public class PlayerMoveListener implements Listener {
	private final NotificationsModule notificationsModule;
	private final EventsModule eventsModule;

	PlayerMoveListener(final ModuleManager moduleManager) {
		this.notificationsModule = moduleManager.getNotificationsModule();
		this.eventsModule = moduleManager.getEventsModule();
	}

	@EventHandler(priority = EventPriority.LOWEST, ignoreCancelled = true)
	public void onPlayerMove(final PlayerMoveEvent event) {
		if (!eventsModule.isNullChunk()) {
			return;
		}

		final Location to = event.getTo();
		final World world = to.getWorld();
		final Chunk chunk = to.getChunk();

		if (chunk == null || !world.isChunkLoaded(chunk)) {
			event.setCancelled(true);
			notificationsModule.debug("[Events] Cancelled movement to null chunk by " + event.getPlayer().getName() + "!");
		}
	}
}
