package dev._2lstudios.exploitfixer.listener;

import org.bukkit.block.Block;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerBucketEmptyEvent;

import dev._2lstudios.exploitfixer.managers.ModuleManager;
import dev._2lstudios.exploitfixer.modules.NotificationsModule;
import dev._2lstudios.exploitfixer.modules.PatcherModule;

public class BucketEmptyListener implements Listener {
    private PatcherModule patcherModule;
    private NotificationsModule notificationsModule;

    public BucketEmptyListener(ModuleManager moduleManager) {
        this.patcherModule = moduleManager.getPatcherModule();
        this.notificationsModule = moduleManager.getNotificationsModule();
    }

    @EventHandler(ignoreCancelled = true)
    public void onBucketEmpty(PlayerBucketEmptyEvent event) {
        if (patcherModule.isEnderPortalBreak()) {
            Player player = event.getPlayer();
            Block relative = event.getBlockClicked().getRelative(event.getBlockFace());
            String materialName = relative.getType().name();
            
            if (materialName.contains("END_PORTAL") || materialName.contains("ENDER_PORTAL")
                    || materialName.contains("END_GATEWAY")) {
                event.setCancelled(true);
                notificationsModule.debug("[Patcher|EnderPortalBreak] A water bucket tried to break an end portal.");
                player.updateInventory();
            }
        }
    }
}
